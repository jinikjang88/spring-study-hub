<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Java 21 Virtual Threads</title>
  <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
<div class="container">
  <div th:replace="~{fragments/header :: header}"></div>

  <div class="content">
    <h1>🧵 Java 21 Virtual Threads</h1>

    <div class="thread-info-card">
      <h2>현재 스레드 정보</h2>
      <div class="info-grid">
        <div class="info-item">
          <span class="label">스레드 이름</span>
          <span class="value" th:text="${threadName}">thread-name</span>
        </div>
        <div class="info-item">
          <span class="label">Virtual Thread 여부</span>
          <span class="value"
                th:text="${isVirtual ? 'Virtual Thread ✅' : 'Platform Thread'}"
                th:classappend="${isVirtual ? 'text-success' : 'text-warning'}">
                            Virtual Thread
                        </span>
        </div>
        <div class="info-item">
          <span class="label">스레드 ID</span>
          <span class="value" th:text="${threadId}">1</span>
        </div>
        <div class="info-item">
          <span class="label">스레드 클래스</span>
          <span class="value" th:text="${threadClass}">VirtualThread</span>
        </div>
      </div>
    </div>

    <div class="comparison-section">
      <h2>Platform Thread vs Virtual Thread</h2>
      <div class="comparison-grid">
        <div class="comparison-card platform">
          <h3>🔷 Platform Thread</h3>
          <ul>
            <li><strong>생성 비용:</strong> 높음 (수 MB 메모리)</li>
            <li><strong>개수 제한:</strong> 수천 개 수준</li>
            <li><strong>컨텍스트 전환:</strong> 무거움</li>
            <li><strong>Blocking I/O:</strong> 리소스 낭비</li>
            <li><strong>사용 케이스:</strong> CPU 집약적 작업</li>
          </ul>
        </div>

        <div class="comparison-card virtual">
          <h3>🟢 Virtual Thread</h3>
          <ul>
            <li><strong>생성 비용:</strong> 매우 낮음 (수 KB)</li>
            <li><strong>개수 제한:</strong> 수백만 개 가능</li>
            <li><strong>컨텍스트 전환:</strong> 가벼움</li>
            <li><strong>Blocking I/O:</strong> 효율적 처리</li>
            <li><strong>사용 케이스:</strong> I/O 집약적 작업</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="code-example">
      <h3>📝 Virtual Thread 생성 코드</h3>
      <pre><code>// 1. Virtual Thread 직접 생성
Thread.ofVirtual().start(() -> {
    System.out.println("Virtual Thread");
});

// 2. Virtual Thread Executor 사용
ExecutorService executor =
    Executors.newVirtualThreadPerTaskExecutor();

// 3. Spring Boot에서 설정
spring:
  threads:
    virtual:
      enabled: true</code></pre>
    </div>

    <div class="benefits-section">
      <h3>✨ Virtual Thread의 장점</h3>
      <div class="benefit-grid">
        <div class="benefit-card">
          <div class="benefit-icon">📈</div>
          <h4>높은 확장성</h4>
          <p>수백만 개의 동시 연결 처리 가능</p>
        </div>
        <div class="benefit-card">
          <div class="benefit-icon">💰</div>
          <h4>리소스 효율</h4>
          <p>메모리 사용량 대폭 감소</p>
        </div>
        <div class="benefit-card">
          <div class="benefit-icon">⚡</div>
          <h4>간단한 코드</h4>
          <p>동기 스타일로 비동기 성능</p>
        </div>
        <div class="benefit-card">
          <div class="benefit-icon">🔄</div>
          <h4>Blocking I/O 개선</h4>
          <p>I/O 대기 시 다른 작업 수행</p>
        </div>
      </div>
    </div>

    <div class="use-cases">
      <h3>🎯 Virtual Thread 사용 시나리오</h3>
      <ul>
        <li><strong>웹 서버:</strong> 높은 동시 요청 처리</li>
        <li><strong>데이터베이스 연결:</strong> 많은 DB 연결 관리</li>
        <li><strong>파일 I/O:</strong> 대량 파일 처리</li>
        <li><strong>네트워크 통신:</strong> 다수의 외부 API 호출</li>
        <li><strong>마이크로서비스:</strong> 서비스 간 통신 최적화</li>
      </ul>
    </div>

    <div class="warning-box">
      <h3>⚠️ 주의사항</h3>
      <ul>
        <li>CPU 집약적 작업에는 Platform Thread가 더 적합</li>
        <li>synchronized 블록은 여전히 Platform Thread로 고정 (Pinning)</li>
        <li>ThreadLocal 사용 시 메모리 주의</li>
        <li>기존 Thread Pool 코드는 리팩토링 필요</li>
      </ul>
    </div>

    <div class="button-group">
      <a th:href="@{/java21/pattern/string}" class="btn">Pattern Matching 예제</a>
      <a th:href="@{/java21/sequenced}" class="btn">Sequenced Collections 예제</a>
      <a th:href="@{/}" class="btn btn-secondary">홈으로</a>
    </div>
  </div>

  <div th:replace="~{fragments/footer :: footer}"></div>
</div>
</body>
</html>